<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>펫 시뮬레이터</title>
<style>
  body {font-family: 'Malgun Gothic', sans-serif; background:#000; color:#fff; margin:0; padding:20px; min-height:100vh;}
  .wrap {max-width:1400px; margin:auto;}
  .main {background:linear-gradient(135deg,#111,#1a1a2e); border-radius:25px; padding:35px; box-shadow:0 0 40px rgba(255,215,0,0.2);}
  .money {text-align:center; font-size:26px; background:#222; padding:20px; border-radius:16px; margin-bottom:20px;}
  .shop {display:grid; grid-template-columns:repeat(5,1fr); gap:15px; margin:30px 0;}
  .btn {padding:20px; font-size:20px; border:none; border-radius:16px; cursor:pointer; font-weight:bold;}
  .n{background:#43a047} .p{background:#8e24aa;color:#fff} .c{background:#ff9800}
  .speed{background:#444;}
  .speed.on {background:#00c853 !important; box-shadow:0 0 30px #0f0;}
  .auto1{background:#d50000; box-shadow:0 0 30px #f00;} .auto2{background:#6a1b9a; box-shadow:0 0 30px #90f;}
  .auto1.on,.auto2.on {background:#00c853; box-shadow:0 0 60px #0f0; animation:pulse 1s infinite;}
  @keyframes pulse {0%,100%{box-shadow:0 0 60px #0f0} 50%{box-shadow:0 0 90px #0f0}}

  .slotbox {display:flex; justify-content:center; gap:40px; margin:40px 0;}
  .slot {width:160px; height:160px; border:6px dashed #666; border-radius:30px; display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:18px; background:#111;}
  .slot.f {border-style:solid; background:#222;}
  #upbtn {width:100%; padding:32px; font-size:34px; background:#d32f2f; border:none; border-radius:20px; color:white; font-weight:bold; margin:20px 0;}

  .pet-list {margin:30px 0; height:170px; overflow-x:auto; overflow-y:hidden; white-space:nowrap; padding:10px 0;}
  .pet-list .grid {display:inline-flex; gap:16px; height:100%;}
  .pet {display:inline-flex; flex-direction:column; justify-content:center; align-items:center; width:135px; height:135px; border-radius:18px; cursor:pointer; font-weight:bold; border:5px solid #444; flex-shrink:0;}
  .pet:hover {transform:scale(1.15);}
  .pet.s {border:8px solid yellow; box-shadow:0 0 50px yellow;}
  .l1{background:#2e7d32} .l2{background:#1565c0} .l3{background:#8e24aa} .l4{background:#e91e63} .l5{background:#ffb300;color:#000;box-shadow:0 0 60px gold;}

  .legend-records {margin-top:30px; height:220px; overflow-x:auto; overflow-y:hidden; white-space:nowrap; padding:15px 0;}
  .legend-records .inner {display:inline-flex; gap:22px;}
  .legend-card {width:300px; height:180px; background:linear-gradient(135deg,#222,#333); border:4px solid gold; border-radius:20px; padding:18px; text-align:center; flex-shrink:0; box-shadow:0 0 30px rgba(255,215,0,0.4);}
  .legend-card b {font-size:22px; color:#ffd700;}
  .legend-card .name {font-size:24px; color:#ffeb3b; margin:8px 0; text-shadow:0 0 10px gold;}
  .legend-card .cost {font-size:28px; color:#fff;}

  .legend-title {text-align:center; color:gold; font-size:32px; margin:20px 0 10px; text-shadow:0 0 15px gold;}
  .info {color:#ff5252; font-size:15px; text-align:center; margin-top:15px; line-height:1.6;}

  #fireworks {position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:10;}
  .particle {position:absolute; border-radius:50%; animation:explode var(--duration) ease-out forwards;}
  @keyframes explode {
    0% {transform:scale(0); opacity:1;}
    100% {transform:scale(var(--scale)) translate(var(--dx), var(--dy)); opacity:0;}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="main">
    <h1>펫 시뮬레이터<br><span style="font-size:22px;color:#ff5252;">천장 없음</span></h1>

    <div class="money">
      보유 금액: <span id="won">100,000</span>원<br>
      <span style="font-size:20px; color:#ffeb3b;">이번 세션 소비: <span id="sessionWon">0</span>원</span>
    </div>

    <div class="shop">
      <button class="btn n" onclick="buyNormal()">일반 티켓 10묶음<br><small>20,000원</small></button>
      <button class="btn p" onclick="buyPremium()">프리미엄 티켓 10묶음<br><small>30,000원</small></button>
      <button class="btn c" onclick="charge()">10만원 충전</button>
      <button class="btn auto1" id="btn1" onclick="toggleAuto(1)">전설 1마리면 멈춤</button>
      <button class="btn auto2" id="btn2" onclick="toggleAuto(2)">무한 오토 + 기록</button>
    </div>

    <div class="shop">
      <button class="btn speed" id="slowBtn" onclick="setSpeed('slow')">SLOW 모드</button>
      <button class="btn speed" id="fastBtn" onclick="setSpeed('fast')">FAST 모드</button>
      <button class="btn speed" id="hyperBtn" onclick="setSpeed('hyper')">HYPER 모드</button>
    </div>

    <div class="slotbox">
      <div class="slot" id="s0">1번 기준</div>
      <div class="slot" id="s1">2번 재료</div>
      <div class="slot" id="s2">3번 재료</div>
    </div>

    <button id="upbtn" onclick="upgrade()">승급 시도</button>

    <div class="pet-list">
      <div class="grid" id="g"></div>
    </div>

    <h2 class="legend-title">★★ 전설 펫 획득 기록 ★★</h2>
    <div class="legend-records">
      <div class="inner" id="records">아직 전설 펫이 없습니다...</div>
    </div>

    <div class="info">
      ※ 프리미엄 티켓: 전설 0% · 에픽 1% · 엘리트 3% · 레어 17% · 고급 79%<br>
      ※ 일반 티켓: 전설 0% · 에픽 0% · 엘리트 0.5% · 레어 5% · 고급 94.5%<br>
      ※ 승급 성공 확률 → 고급 30% · 레어 30% · 엘리트 25% · 에픽 20%
    </div>
  </div>
</div>
<div id="fireworks"></div>

<script>
let pets = [], sel = [], won = 100000, id = 0;
let totalSpent = 0, sessionSpent = 0;
let autoMode = 0, running = false;
let records = [];
let speed = 'hyper';

const 등급 = ['','고급','레어','엘리트','에픽','전설'];
const colors = {1: '#2e7d32', 2: '#1565c0', 3: '#8e24aa', 4: '#e91e63', 5: '#ffb300'};

// 정확한 확정 확률 (2025 최신)
const 일반티켓 = {1:0.945, 2:0.05, 3:0.005, 4:0,    5:0};     // 고급 94.5%, 레어 5%, 엘리트 0.5%
const 프리미엄 = {1:0.79,  2:0.17, 3:0.03,  4:0.01, 5:0};     // 고급 79%, 레어 17%, 엘리트 3%, 에픽 1%, 전설 0%

// 승급 성공 확률 (기존 그대로)
const 승급확률 = [0, 0.30, 0.30, 0.25, 0.20];  // 고급→레어 30%, 레어→엘리트 30%, 엘리트→에픽 25%, 에픽→전설 20%

function 이름(){
  const a = ['용맹한','신비로운','날렵한','불타는','얼음','번개','어둠의','빛나는','전설의','야생의','강철','마법의','신성한','고독한','영원한','황금'];
  const b = ['','왕 ','수호 ','파괴자 ','전사 ','영웅 ','제왕 ','절대 ','은빛 ','검은 '];
  const c = ['사자','호랑이','용','늑대','여우','표범','곰','불사조','유니콘','그리핀','페가수스','케르베로스','히드라','드래곤','페어리','스핑크스'];
  return a[Math.floor(Math.random()*a.length)] + b[Math.floor(Math.random()*b.length)] + c[Math.floor(Math.random()*c.length)];
}

function charge(){ 
  won += 100000; totalSpent += 100000; sessionSpent += 100000; updateMoney(); 
}

function updateMoney(){ 
  document.getElementById('won').textContent = won.toLocaleString();
  document.getElementById('sessionWon').textContent = sessionSpent.toLocaleString();
}

function buyNormal(){
  if(won < 20000) { alert("금액 부족!"); return; }
  won -= 20000; totalSpent += 20000; sessionSpent += 20000; updateMoney();
  for(let i=0; i<10; i++) 뽑기(일반티켓);
}

function buyPremium(){
  if(won < 30000) { alert("금액 부족!"); return; }
  won -= 30000; totalSpent += 30000; sessionSpent += 30000; updateMoney();
  for(let i=0; i<10; i++) 뽑기(프리미엄);
}

function 뽑기(표){
  const r = Math.random();
  let sum = 0, lv = 1;
  for(let i=1; i<=5; i++){
    sum += 표[i] || 0;
    if(r <= sum){ lv = i; break; }
  }
  const petName = 이름();
  pets.push({id: id++, n: petName, lv: lv});
  render();
}

function render(){
  const g = document.getElementById('g'); g.innerHTML = '';
  const baseLv = sel.length ? pets.find(p=>p.id===sel[0])?.lv : null;
  pets.filter(p => p.lv < 5).forEach(p => {
    const d = document.createElement('div');
    d.className = `pet l${p.lv} ${sel.includes(p.id)?'s':''}`;
    if(sel.length && !sel.includes(p.id) && p.lv !== baseLv) d.style.opacity = '0.4';
    d.onclick = () => { 
      if(d.style.opacity==='0.4') return; 
      sel.includes(p.id) ? sel = sel.filter(x=>x!==p.id) : sel.length<3 && sel.push(p.id); 
      render(); updateSlot(); 
    };
    d.innerHTML = `<div style="font-size:14px">${p.n}</div><div>${등급[p.lv]}</div>`;
    g.appendChild(d);
  });
}

function updateSlot(){
  for(let i=0;i<3;i++){
    const s = document.getElementById('s'+i);
    if(i < sel.length && pets.find(p=>p.id===sel[i])){
      const p = pets.find(p=>p.id===sel[i]);
      s.innerHTML = `<div>${p.n}</div><div>${등급[p.lv]}</div>`;
      s.className = `slot l${p.lv} f`;
    } else {
      s.innerHTML = i===0?'1번 기준':'재료';
      s.className = 'slot';
    }
  }
  document.getElementById('upbtn').disabled = sel.length !== 3;
}

function upgrade(){
  if(sel.length!==3) return;
  const base = pets.find(p=>p.id===sel[0]);
  pets = pets.filter(p => !sel.slice(1).includes(p.id));
  sel = [];
  const oldLv = base.lv;
  if(Math.random() < 승급확률[oldLv]){
    base.lv++; base.n += "★";
    if(speed !== 'hyper') showFireworks(base.lv);
    if(base.lv===5) checkLegend(base.n);
  }
  render(); updateSlot();
}

function showFireworks(lv){
  const fireworks = document.getElementById('fireworks');
  fireworks.innerHTML = ''; // 이전 폭죽 제거하여 렉 줄임
  let intensity;
  if(speed === 'slow') {
    intensity = lv * 20;
  } else if(speed === 'fast') {
    intensity = lv * 5; // fast 모드에서 간소화 (파티클 수 줄임)
  } else {
    return; // hyper에서는 표시 안 함
  }
  const color = colors[lv];
  const baseSize = 10 + lv * 3;
  const maxScale = 3 + lv * 1;
  const baseDuration = 0.5 + lv * 0.4;
  const removeTime = 1500 + lv * 1000;

  for(let i=0; i<intensity; i++){
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.background = color;
    p.style.width = baseSize + 'px';
    p.style.height = baseSize + 'px';
    p.style.left = Math.random()*100 + '%';
    p.style.top = Math.random()*100 + '%';
    p.style.setProperty('--dx', (Math.random()-0.5)* (200 + lv * 50) + 'px');
    p.style.setProperty('--dy', (Math.random()-0.5)* (200 + lv * 50) + 'px');
    p.style.setProperty('--scale', maxScale);
    p.style.setProperty('--duration', (Math.random()*0.5 + baseDuration) + 's');
    fireworks.appendChild(p);
    setTimeout(() => p.remove(), removeTime);
  }
}

function autoSelect(){
  const cnt = [0,0,0,0,0,0];
  pets.forEach(p => p.lv<5 && cnt[p.lv]++);
  for(let i=4; i>=1; i--) if(cnt[i]>=3){
    const cand = pets.filter(p=>p.lv===i && p.lv<5);
    sel = [cand[0].id, cand[1].id, cand[2].id];
    render(); updateSlot();
    return true;
  }
  return false;
}

function checkLegend(petName){
  const num = records.length + 1;
  const thisSpent = sessionSpent;
  records.push({num, name: petName, spent: thisSpent, total: totalSpent});

  const container = document.getElementById('records');
  container.innerHTML = '';
  records.slice().reverse().forEach(r => container.appendChild(createCard(r)));
  
  if(autoMode===1){
    running = false;
    toggleAuto(1); // 알림창 없이 멈춤만
  } else {
    sessionSpent = 0;
    updateMoney();
  }
}

function createCard(r){
  const div = document.createElement('div');
  div.className = 'legend-card';
  div.innerHTML = `
    <b>#${r.num} 전설</b>
    <div class="name">「${r.name}」</div>
    <div style="color:#ffeb3b;">이번 비용</div>
    <div class="cost">${r.spent.toLocaleString()}원</div>
    <div style="font-size:14px; color:#aaa;">누적 ${r.total.toLocaleString()}원</div>
  `;
  return div;
}

function setSpeed(mode){
  speed = mode;
  document.getElementById('slowBtn').classList.toggle('on', mode==='slow');
  document.getElementById('fastBtn').classList.toggle('on', mode==='fast');
  document.getElementById('hyperBtn').classList.toggle('on', mode==='hyper');
  document.getElementById('slowBtn').textContent = mode==='slow' ? 'SLOW 모드 (선택됨)' : 'SLOW 모드';
  document.getElementById('fastBtn').textContent = mode==='fast' ? 'FAST 모드 (선택됨)' : 'FAST 모드';
  document.getElementById('hyperBtn').textContent = mode==='hyper' ? 'HYPER 모드 (선택됨)' : 'HYPER 모드';
}

function gameLoop(){
  if(!running) return;

  let loops = speed === 'slow' ? 2 : speed === 'fast' ? 70 : 1000;

  for(let i=0; i<loops; i++){
    if(won < 30000){
      charge();
    }
    if(!autoSelect()){
      buyPremium();  // 현실 반영: 전설 노리는 사람은 무조건 프리미엄
      if(speed==='slow') render();
    } else {
      upgrade();
    }
  }
  if(speed!=='slow') render();
  requestAnimationFrame(gameLoop);
}

function toggleAuto(mode){
  if(autoMode === mode){
    running = false; autoMode = 0;
    document.getElementById('btn1').classList.remove('on'); document.getElementById('btn1').textContent = '전설 1마리면 멈춤';
    document.getElementById('btn2').classList.remove('on'); document.getElementById('btn2').textContent = '무한 오토 + 기록';
    return;
  }
  running = true; autoMode = mode;
  sessionSpent = 0; updateMoney();
  document.getElementById('btn'+mode).classList.add('on');
  document.getElementById('btn'+mode).textContent = mode===1?'작동중 (1마리 멈춤)':'작동중 (무한 기록)';
  gameLoop();
}

render(); updateSlot(); updateMoney();
setSpeed('hyper');
</script>
</body>
</html>
